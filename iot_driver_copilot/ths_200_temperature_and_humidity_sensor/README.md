THS-200 Temperature and Humidity Sensor Driver (HTTP + MQTT)

Overview
- Device: ExampleTech THS-200 (Temperature & Humidity)
- Native Protocol: MQTT over TCP/IP (JSON messages)
- Driver Language: Go
- Purpose: Provide an HTTP interface to configure MQTT publishing and monitor status, while the driver periodically publishes JSON readings to the configured MQTT broker/topic.

Key Features
- Periodic JSON publishing to MQTT (default interval: 10 seconds)
- Configurable broker address and topic via HTTP or environment variables
- Automatic reconnect with exponential backoff on connection loss
- Thread-safe latest-sample buffer and status reporting via /status
- Graceful shutdown on SIGINT/SIGTERM

Build
- Requires Go 1.22+
- Fetch dependencies and build:
  - go build -o ths200-driver

Run
- Configure via environment variables (optional) and start the HTTP server:
  - HTTP_HOST: HTTP server host (default: 0.0.0.0)
  - HTTP_PORT: HTTP server port (default: 8080)
  - MQTT_BROKER: Initial MQTT broker address, e.g. tcp://localhost:1883 (optional)
  - MQTT_TOPIC: Initial MQTT topic to publish to (optional)
  - MQTT_CLIENT_ID: MQTT client ID (default: autogenerated)
  - MQTT_USERNAME: MQTT username (optional)
  - MQTT_PASSWORD: MQTT password (optional)
  - PUBLISH_INTERVAL_SEC: Publish interval seconds (default: 10)
  - MQTT_CONNECT_TIMEOUT_SEC: MQTT connect timeout seconds (default: 5)
  - MQTT_RETRY_BASE_DELAY_MS: Base delay in ms for exponential backoff (default: 500)
  - MQTT_RETRY_MAX_DELAY_SEC: Max delay seconds for backoff (default: 30)
  - MQTT_QOS: MQTT QoS level 0/1/2 (default: 0)
  - SHUTDOWN_TIMEOUT_SEC: HTTP/MQTT shutdown timeout seconds (default: 5)

Example:
- MQTT_BROKER=tcp://localhost:1883 MQTT_TOPIC=sensors/ths200 go run .
- Or with the built binary: MQTT_BROKER=tcp://localhost:1883 MQTT_TOPIC=sensors/ths200 ./ths200-driver

HTTP API
- PUT /config/mqtt
  - Description: Set or update the MQTT publishing configuration. Provide broker_address and topic. After update, the driver connects/reconnects and continues periodic JSON publishing.
  - Request Body (JSON): {"broker_address": "tcp://localhost:1883", "topic": "sensors/ths200"}
  - Example:
    - curl -X PUT http://localhost:8080/config/mqtt -H 'Content-Type: application/json' -d '{"broker_address":"tcp://localhost:1883","topic":"sensors/ths200"}'

- GET /config/mqtt
  - Description: Read the current MQTT publishing configuration.
  - Example:
    - curl http://localhost:8080/config/mqtt

- GET /status
  - Description: Get current operational status (connected, publishing, last publish time, last payload, etc.).
  - Example:
    - curl http://localhost:8080/status

MQTT Payload Format
- Example JSON payload published by the driver every interval:
  - {"temperature": 25.3, "humidity": 60.2}

Notes
- The driver automatically reconnects to the MQTT broker using exponential backoff on failures.
- If MQTT_BROKER and MQTT_TOPIC are not provided via environment variables, configure them at runtime using PUT /config/mqtt.

License
- MIT

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)