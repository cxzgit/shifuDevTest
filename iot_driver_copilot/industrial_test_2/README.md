Industrial Environmental Sensor Modbus RTU to HTTP Driver (C++)

Overview
- Connects to a Modbus RTU (RS-485) environmental sensor (temperature, humidity, CO₂) using function code 0x03 (read holding registers).
- Polls configured registers at a specified interval and exposes an HTTP server with two endpoints: /status and /readings.
- Implements a resilient background collection loop (timeouts, retry, exponential backoff) and a thread-safe buffer for latest readings.

Build
- Requires a POSIX system (Linux) with g++.
- Compile:
  g++ -std=c++17 driver.cpp -o driver -pthread

Run
- Configure using environment variables, then start the driver:
  HTTP_HOST=0.0.0.0 \
  HTTP_PORT=8080 \
  SERIAL_PORT=/dev/ttyUSB0 \
  SERIAL_BAUD=9600 \
  SERIAL_DATABITS=8 \
  SERIAL_STOPBITS=1 \
  SERIAL_PARITY=N \
  MODBUS_SLAVE_ID=1 \
  TEMP_ADDR=0 \
  TEMP_QTY=1 \
  TEMP_SCALE=0.1 \
  HUM_ADDR=1 \
  HUM_QTY=1 \
  HUM_SCALE=0.1 \
  CO2_ADDR=2 \
  CO2_QTY=1 \
  CO2_SCALE=1.0 \
  POLL_INTERVAL_MS=1000 \
  READ_TIMEOUT_MS=500 \
  RETRY_INIT_MS=200 \
  RETRY_MAX_MS=5000 \
  RETRY_MULTIPLIER=2.0 \
  ./driver

Environment Variables
- HTTP_HOST: Host/IP for HTTP server (e.g., 0.0.0.0)
- HTTP_PORT: Port for HTTP server (e.g., 8080)
- SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0)
- SERIAL_BAUD: Baud rate (supported: 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200)
- SERIAL_DATABITS: Data bits (7 or 8)
- SERIAL_STOPBITS: Stop bits (1 or 2)
- SERIAL_PARITY: Parity ('N', 'E', 'O')
- MODBUS_SLAVE_ID: Device slave ID (0–247)
- TEMP_ADDR: Holding register address for temperature
- TEMP_QTY: Number of registers to read for temperature (1 or 2)
- TEMP_SCALE: Scale factor applied to temperature raw value
- HUM_ADDR: Holding register address for humidity
- HUM_QTY: Number of registers to read for humidity (1 or 2)
- HUM_SCALE: Scale factor applied to humidity raw value
- CO2_ADDR: Holding register address for CO₂
- CO2_QTY: Number of registers to read for CO₂ (1 or 2)
- CO2_SCALE: Scale factor applied to CO₂ raw value
- POLL_INTERVAL_MS: Polling interval in milliseconds
- READ_TIMEOUT_MS: Per-request read timeout in milliseconds
- RETRY_INIT_MS: Initial backoff delay in milliseconds when connection fails
- RETRY_MAX_MS: Maximum backoff delay in milliseconds
- RETRY_MULTIPLIER: Backoff multiplication factor (>= 1.0)

HTTP APIs
- GET /status
  Returns JSON with connection status, configured serial port and slave_id, polling activity, interval, and last poll time.
  Example:
    curl http://localhost:8080/status

- GET /readings
  Returns latest parsed temperature, humidity, and CO₂ readings with timestamps.
  Example:
    curl http://localhost:8080/readings

Notes
- This driver implements Modbus RTU over a POSIX serial port using function code 0x03.
- The driver actively polls the configured registers and serves parsed values over HTTP without exposing native protocol URLs.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)