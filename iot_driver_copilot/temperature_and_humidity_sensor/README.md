Temperature & Humidity Modbus RTU Driver (Java)

Overview
- Bridges a Modbus RTU (RS485) temperature & humidity sensor to an HTTP interface.
- Periodically polls the device over serial (Modbus RTU, 9600 8N1), decodes registers, and exposes HTTP endpoints.
- Implements robust retry with exponential backoff and maintains the latest reading in memory.

Important Notes
- All configuration is provided via environment variables. Runtime reconfiguration via HTTP is not supported; the /config PUT endpoint validates but does not change settings.
- Serial port parameters are fixed at 9600 baud, 8 data bits, no parity, 1 stop bit (8N1). This driver assumes the OS/adapter defaults to 9600 8N1. If needed, configure the serial port externally before running the driver.

Build & Run
- Requires Java 11+.

Compile:
  javac Driver.java Config.java ModbusRTU.java Poller.java SimpleJson.java

Run:
  HTTP_HOST=0.0.0.0 \
  HTTP_PORT=8080 \
  SERIAL_PORT=/dev/ttyUSB0 \
  MODBUS_SLAVE_ID=1 \
  POLL_INTERVAL_MS=1000 \
  MODBUS_FUNCTION=4 \
  HUMIDITY_REGISTER=0 \
  TEMPERATURE_REGISTER=1 \
  VALUE_DIVISOR=10 \
  SERIAL_TIMEOUT_MS=800 \
  BACKOFF_INITIAL_MS=500 \
  BACKOFF_MAX_MS=10000 \
  java Driver

Environment Variables (required)
- HTTP_HOST: Host/IP for HTTP server bind (e.g., 0.0.0.0)
- HTTP_PORT: Port for HTTP server (e.g., 8080)
- SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0)
- MODBUS_SLAVE_ID: Modbus slave/unit ID (1–247)
- POLL_INTERVAL_MS: Polling interval in milliseconds (>=100)
- MODBUS_FUNCTION: 3 for Holding Registers or 4 for Input Registers
- HUMIDITY_REGISTER: Register address containing humidity (0–65535)
- TEMPERATURE_REGISTER: Register address containing temperature (0–65535)
- VALUE_DIVISOR: Divisor to scale raw values (e.g., 10 means raw/10.0)
- SERIAL_TIMEOUT_MS: Per-request timeout in milliseconds
- BACKOFF_INITIAL_MS: Initial backoff delay after an error (ms)
- BACKOFF_MAX_MS: Maximum backoff delay after repeated errors (ms)

HTTP API
- GET /config
  Returns current configuration (serial_port, slave_id, poll_interval_ms, and fixed 9600 8N1), plus register/function info.
  Example:
    curl -s http://localhost:8080/config | jq

- PUT /config
  Validates requested settings against environment-based configuration. Returns 200 if matching, 409 if not.
  Example:
    curl -s -X PUT http://localhost:8080/config \
      -H 'Content-Type: application/json' \
      -d '{"serial_port":"/dev/ttyUSB0","slave_id":1,"poll_interval_ms":1000}'

- POST /polling/start
  Starts periodic polling.
  Example:
    curl -s -X POST http://localhost:8080/polling/start

- POST /polling/stop
  Stops periodic polling and releases the serial port.
  Example:
    curl -s -X POST http://localhost:8080/polling/stop

- GET /status
  Returns polling and link health (polling, connected, last_poll_time, last_success_time, last_error, timeout_count, consecutive_timeouts).
  Example:
    curl -s http://localhost:8080/status | jq

- GET /readings/latest
  Returns the most recent decoded measurement with timestamp and staleness flag.
  Example:
    curl -s http://localhost:8080/readings/latest | jq

Decoding Assumptions
- The driver reads both humidity and temperature registers in one Modbus transaction starting at the lower of HUMIDITY_REGISTER and TEMPERATURE_REGISTER.
- Raw values are divided by VALUE_DIVISOR. Temperature is treated as signed 16-bit.

Logging
- Logs key events to stdout: server start, polling start/stop, serial open/close, errors, retries, and timestamped updates.

Graceful Shutdown
- CTRL+C or process stop will terminate the HTTP server and polling loop cleanly.

Security
- No authentication is implemented. Deploy behind appropriate network controls if needed.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
