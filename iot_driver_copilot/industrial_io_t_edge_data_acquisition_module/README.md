Industrial IoT Edge Data Acquisition Module Driver (DAQ-2000) - HTTP Modbus Proxy

Overview
- This Golang driver connects to a Siemens DAQ-2000 over its native Modbus protocol (TCP or RTU) and exposes a simple HTTP endpoint to read coils, discrete inputs, input registers, or holding registers.
- It runs a background collection loop with automatic retry/backoff, maintains a thread-safe buffer with the latest sampled data, and logs key events for diagnostics.

Environment Variables
- HTTP_HOST: HTTP server bind host (e.g., 0.0.0.0)
- HTTP_PORT: HTTP server port (e.g., 8080)
- MODBUS_PROTOCOL: Modbus transport to use for background polling: tcp or rtu
- For TCP (used when MODBUS_PROTOCOL=tcp):
  - DEVICE_HOST: Modbus TCP device host (e.g., 192.168.1.50)
  - DEVICE_PORT: Modbus TCP device port (e.g., 502)
- For RTU (used when MODBUS_PROTOCOL=rtu):
  - SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0 or COM3)
  - SERIAL_BAUD: Baud rate (e.g., 9600)
  - SERIAL_PARITY: Parity (N, E, O or NONE, EVEN, ODD)
  - SERIAL_STOPBITS: Stop bits (1 or 2)
  - SERIAL_DATABITS: Data bits (usually 8)
- Common:
  - SLAVE_ID: Modbus slave/unit ID (e.g., 1)
  - TIMEOUT_MS: Modbus operation timeout in milliseconds (e.g., 1000)
- Background Polling:
  - POLL_TABLE: coil | discrete | input | holding (which register group to poll)
  - POLL_ADDRESS: Start address for polling (e.g., 0)
  - POLL_QUANTITY: Number of points/registers to poll (e.g., 16)
  - POLL_INTERVAL_MS: Poll interval in milliseconds (e.g., 500)
- Retry/Backoff:
  - RETRY_INITIAL_MS: Initial backoff delay in ms (e.g., 500)
  - RETRY_MAX_MS: Maximum backoff delay in ms (e.g., 5000)
  - RETRY_MAX_ATTEMPTS: Maximum retry attempts before capping backoff (e.g., 10)

Run
1) Set the required environment variables for your transport (TCP or RTU) and polling configuration.
2) Build and run:
   - go build -o driver
   - ./driver

HTTP API
- GET /modbus/read
  - Query parameters (optional; defaults to env configuration):
    - protocol: tcp | rtu
    - host: hostname/IP (TCP)
    - port: TCP port (TCP)
    - serial_port: serial port path (RTU)
    - slave_id: Modbus slave ID
    - table: coil | discrete | input | holding
    - address: start address
    - quantity: number of points/registers
    - timeout_ms: operation timeout in ms
  - Returns JSON with the requested values and metadata. If the request matches the background polling configuration, the driver returns the cached sample for fast responses; otherwise, it performs a live read.

Example curl
- TCP holding registers:
  curl "http://localhost:8080/modbus/read?protocol=tcp&host=192.168.1.50&port=502&slave_id=1&table=holding&address=0&quantity=10&timeout_ms=1000"
- RTU coils using cached polling config (assuming env matches):
  curl "http://localhost:8080/modbus/read?protocol=rtu&table=coil"

Notes
- The driver manages connection retries with exponential backoff, logs connect/disconnect and read errors, and shuts down gracefully on SIGINT/SIGTERM.
- All configuration values are sourced from environment variables; request query parameters can override them per-call without changing the background polling configuration.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)