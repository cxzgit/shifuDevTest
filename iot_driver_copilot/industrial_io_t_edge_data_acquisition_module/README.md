IoT Driver for Honeywell DA-01 (Industrial IoT Edge Data Acquisition Module)

Overview
- Connects to the device via its native protocols (Modbus TCP or Modbus RTU; optional MQTT connectivity)
- Performs real-time acquisition (≤ 1s interval) from configurable Modbus register ranges
- Exposes a single HTTP endpoint to present device and communication status
- Implements robust retries with exponential backoff, structured JSON logging, and graceful shutdown

Build and Run
1) Ensure Go (1.21+) is installed.

2) Set required environment variables (examples below), then run:
- Build: go build -o driver
- Run: ./driver

Environment Variables
HTTP server
- HTTP_HOST: HTTP bind host (default: 0.0.0.0)
- HTTP_PORT: HTTP port (default: 8080)

Protocol selection
- PROTOCOL: tcp or rtu. If not set, auto-detected from MODBUS_TCP_ADDR or SERIAL_PORT

Modbus TCP
- MODBUS_TCP_ADDR: host:port of device (required if PROTOCOL=tcp)
- TCP_TIMEOUT_MS: Modbus request timeout in ms (default: 1000)

Modbus RTU
- SERIAL_PORT: serial device path, e.g. /dev/ttyUSB0 (required if PROTOCOL=rtu)
- BAUD_RATE: baud rate (default: 9600)
- DATA_BITS: data bits (default: 8)
- PARITY: N/E/O (default: N)
- STOP_BITS: 1 or 2 (default: 1)

Common Modbus
- SLAVE_ID: Modbus unit id (default: 1)
- POLL_INTERVAL_MS: poll interval in ms; capped at ≤1000ms (default: 1000)

Register read configuration (all optional; set count>0 to enable)
- READ_HOLDING_START (default: 0)
- READ_HOLDING_COUNT (default: 10)
- READ_INPUT_START (default: 0)
- READ_INPUT_COUNT (default: 0)
- READ_COIL_START (default: 0)
- READ_COIL_COUNT (default: 0)
- READ_DISCRETE_START (default: 0)
- READ_DISCRETE_COUNT (default: 0)

Retry/Backoff
- RETRY_INITIAL_MS: initial reconnect backoff (default: 500)
- RETRY_MAX_MS: max reconnect backoff (default: 10000)

Optional MQTT connectivity (for link status/diagnostics)
- MQTT_BROKER: e.g. tcp://broker:1883
- MQTT_CLIENT_ID: client id (optional)
- MQTT_USERNAME: username (optional)
- MQTT_PASSWORD: password (optional)
- MQTT_TOPIC: topic to subscribe for diagnostics (optional)
- MQTT_KEEPALIVE_S: keepalive seconds (default: 30)

HTTP API
- GET /status
  Returns JSON with overall device health and communication status, including:
  - network link state
  - Modbus RTU/TCP readiness
  - MQTT connection state
  - acquisition status
  - current update interval
  - last sample timestamp
  - summary of recent errors and reconnect attempts

Quick Start Examples
1) Modbus TCP
- export PROTOCOL=tcp
- export MODBUS_TCP_ADDR=192.168.1.50:502
- ./driver
- curl http://localhost:8080/status

2) Modbus RTU
- export PROTOCOL=rtu
- export SERIAL_PORT=/dev/ttyUSB0
- export BAUD_RATE=19200
- ./driver
- curl http://localhost:8080/status

One-liner curl example
- curl -s http://127.0.0.1:8080/status | jq

Notes
- This driver actively polls the device using Modbus and maintains an internal buffer with the latest sample for fast responses.
- Only the required /status endpoint is exposed. No native protocol URLs are exposed or redirected.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
