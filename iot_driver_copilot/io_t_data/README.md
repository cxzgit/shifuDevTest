IoT Data Driver (HTTP status gateway)

Overview
- This driver connects to the IoT module using its native protocol and exposes an HTTP endpoint to report the driver/device health and connectivity.
- It runs a background collection loop that polls the device (HTTP or Modbus TCP), maintains the latest sample, and implements timeout, retry, and exponential backoff.
- Only the required endpoint is implemented: GET /status

Run
- Requirements: Node.js 16+ (no external dependencies needed)
- Install: no installation required
- Start: HTTP protocol example
  HTTP_HOST=0.0.0.0 HTTP_PORT=8000 DEVICE_PROTOCOL=HTTP DEV_HTTP_URL=http://192.168.1.10/api/data node driver.js
- Start: Modbus TCP example
  HTTP_HOST=0.0.0.0 HTTP_PORT=8000 DEVICE_PROTOCOL=MODBUS_TCP MB_HOST=192.168.1.20 MB_PORT=502 MB_UNIT_ID=1 MB_START_ADDR=0 MB_NUM_REGS=16 node driver.js

Environment Variables
- HTTP_HOST: HTTP server bind host (default: 0.0.0.0)
- HTTP_PORT: HTTP server port (default: 8000)
- DEVICE_PROTOCOL: Native device protocol to use. Supported: HTTP, MODBUS_TCP (default: HTTP)
- POLL_INTERVAL_MS: Polling interval for device reads (default: 2000)
- TIMEOUT_MS: Request/operation timeout (default: 5000)
- BACKOFF_MIN_MS: Initial backoff after error (default: 1000)
- BACKOFF_MAX_MS: Maximum backoff after repeated errors (default: 30000)

For HTTP devices
- DEV_HTTP_URL: Device HTTP endpoint returning JSON (e.g., http://<ip>/api/data)
- DEV_HTTP_BASIC_USER: Basic auth username (optional)
- DEV_HTTP_BASIC_PASS: Basic auth password (optional)
- DEV_HTTP_INSECURE: If true, skip TLS verification for HTTPS (default: false)

For Modbus TCP devices
- MB_HOST: Modbus TCP device host/IP
- MB_PORT: Modbus TCP port (default: 502)
- MB_UNIT_ID: Modbus unit id (default: 1)
- MB_START_ADDR: Start register address for read (default: 0)
- MB_NUM_REGS: Number of registers to read (optional if MB_MAP_JSON provided; computed automatically otherwise)
- MB_WORD_ORDER: Word order for 32-bit values: BE or LE (default: BE)
- MB_MAP_JSON: JSON mapping to parse registers into structured values. Example:
  {"temperature":{"offset":0,"type":"int16","scale":0.1},"humidity":{"offset":1,"type":"uint16","scale":0.1},"voltage":{"offset":2,"type":"uint16","scale":0.01},"status_flags":{"offset":3,"type":"bits16","labels":{"ok":0,"overheat":1}},"error_codes":{"offset":4,"type":"uint16"},"diagnostic_status":{"offset":5,"type":"uint16"}}

HTTP API
- GET /status
  Returns JSON with device/driver status to verify health and connectivity before reading data.

Example
- curl http://localhost:8000/status

Notes
- This driver actively polls the device using the selected native protocol and never forwards native protocol URLs.
- It implements exponential backoff, retries, and maintains a latest-sample buffer internally.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
