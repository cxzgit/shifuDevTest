Industrial Environmental Sensor Driver (Modbus RTU to HTTP)

Overview
- This driver connects to a Modbus RTU (RS485) temperature and humidity sensor, continuously collects data with CRC16 verification, and exposes an HTTP endpoint for monitoring connectivity and health.
- The driver performs protocol conversion by actively ingesting device data (via Modbus RTU) and serving a JSON status over HTTP.

HTTP API (only required endpoints implemented)
- GET /status
  Returns JSON with: connection_state (connected|disconnected|reconnecting), port, device_id, last_seen timestamp, last_error (type: timeout|crc_mismatch|invalid_response with message), error_counters (timeouts, crc_mismatches, invalid_responses), retries_in_progress, auto_reconnect (enabled|disabled), and current sample_interval_s (read from device registers).

Example
- curl command: curl http://127.0.0.1:8080/status

Environment Variables (all required unless noted as optional)
- HTTP_HOST: HTTP server listen host (e.g., 0.0.0.0 or 127.0.0.1)
- HTTP_PORT: HTTP server port (e.g., 8080)
- SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0)
- BAUD_RATE: Serial baud rate (supported: 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200)
- DATA_BITS: 7 or 8
- PARITY: N (none), E (even), O (odd)
- STOP_BITS: 1 or 2
- MODBUS_ID: Slave address (1–247)
- REG_TEMP_ADDR: Holding register address for temperature (start address)
- REG_TEMP_LEN: Number of registers for temperature (1 or 2)
- TEMP_SCALE: Scale factor for raw temperature value
- TEMP_OFFSET: Offset for scaled temperature value
- REG_HUM_ADDR: Holding register address for humidity (start address)
- REG_HUM_LEN: Number of registers for humidity (1 or 2)
- HUM_SCALE: Scale factor for raw humidity value
- HUM_OFFSET: Offset for scaled humidity value
- REG_SAMPLE_ADDR: Holding register address for device sampling interval (seconds)
- REG_SAMPLE_LEN: Number of registers for sampling interval (typically 1)
- READ_TIMEOUT_MS: Read timeout per transaction (milliseconds)
- WRITE_TIMEOUT_MS: Write timeout per transaction (milliseconds)
- POLL_INTERVAL_MS: Background poll interval (milliseconds)
- RETRY_BASE_MS: Initial backoff delay for reconnection attempts (milliseconds)
- RETRY_MAX_MS: Maximum backoff delay for reconnection attempts (milliseconds)
- AUTO_RECONNECT: enabled or disabled; if enabled, the driver will automatically reconnect with exponential backoff
- SET_SAMPLE_INTERVAL_S (optional): If provided (1–60), the driver will write this value to REG_SAMPLE_ADDR via Modbus function 0x06 on startup.

Build & Run
1. Build: g++ -std=c++17 driver.cpp -o driver
2. Run (example):
   HTTP_HOST=0.0.0.0 \
   HTTP_PORT=8080 \
   SERIAL_PORT=/dev/ttyUSB0 \
   BAUD_RATE=9600 \
   DATA_BITS=8 \
   PARITY=N \
   STOP_BITS=1 \
   MODBUS_ID=1 \
   REG_TEMP_ADDR=0 \
   REG_TEMP_LEN=1 \
   TEMP_SCALE=0.1 \
   TEMP_OFFSET=0 \
   REG_HUM_ADDR=1 \
   REG_HUM_LEN=1 \
   HUM_SCALE=0.1 \
   HUM_OFFSET=0 \
   REG_SAMPLE_ADDR=10 \
   REG_SAMPLE_LEN=1 \
   READ_TIMEOUT_MS=500 \
   WRITE_TIMEOUT_MS=500 \
   POLL_INTERVAL_MS=1000 \
   RETRY_BASE_MS=500 \
   RETRY_MAX_MS=8000 \
   AUTO_RECONNECT=enabled \
   ./driver

Notes
- The driver validates Modbus CRC16 on both requests and responses.
- Background collection includes timeouts, CRC mismatch, and invalid response handling; the driver maintains counters and last_error details.
- Automatic reconnection uses exponential backoff within the configured base and maximum limits.
- The driver runs on POSIX systems (Linux) using termios for serial and a built-in minimal HTTP server using sockets.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
