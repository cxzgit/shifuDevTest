Ambient Temperature and Humidity Sensor HTTP Driver (Modbus RTU)

Overview
- Connects to a Modbus RTU device (RS-485) that exposes temperature, humidity, and sampling interval via holding registers.
- Periodically polls the configured registers over serial, decodes/scales raw values, and exposes them via HTTP.
- Implements resilience: timeouts, retry with exponential backoff, and graceful shutdown.

HTTP API
- GET /readings
  Returns latest sensor data in JSON: temperature_c (°C), humidity_percent (%RH), sampling_interval_sec, last_update (UTC RFC3339).
- GET /status
  Returns driver health info: connected, last_success, last_error, and context (serial_port, baud_rate, data_bits, parity, stop_bits, slave_id, poll_interval_ms, read_timeout_ms).

Required Environment Variables
- HTTP_HOST: HTTP server host (e.g., 0.0.0.0)
- HTTP_PORT: HTTP server port (e.g., 8080)
- SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0 or COM3)
- BAUD_RATE: Serial baud rate (e.g., 9600)
- DATA_BITS: Serial data bits (e.g., 8)
- PARITY: Serial parity (N, E, or O)
- STOP_BITS: Serial stop bits (1 or 2)
- SLAVE_ID: Modbus slave ID (0–247)
- REG_TEMP_ADDR: Holding register address for temperature (uint16)
- REG_HUM_ADDR: Holding register address for humidity (uint16)
- REG_SAMPLING_ADDR: Holding register address for sampling interval (uint16)
- SCALE_TEMP: Scale factor applied to raw temperature register (float64)
- SCALE_HUM: Scale factor applied to raw humidity register (float64)
- POLL_INTERVAL_MS: Polling interval in milliseconds
- READ_TIMEOUT_MS: Modbus/serial read timeout in milliseconds
- RETRY_INITIAL_MS: Initial backoff delay for reconnect attempts (ms)
- RETRY_MAX_MS: Maximum backoff delay (ms)
- RETRY_MULTIPLIER: Exponential backoff multiplier (>= 1.0)

Build and Run
1) Set environment variables (example):

   export HTTP_HOST=0.0.0.0
   export HTTP_PORT=8080
   export SERIAL_PORT=/dev/ttyUSB0
   export BAUD_RATE=9600
   export DATA_BITS=8
   export PARITY=N
   export STOP_BITS=1
   export SLAVE_ID=1
   export REG_TEMP_ADDR=100
   export REG_HUM_ADDR=101
   export REG_SAMPLING_ADDR=200
   export SCALE_TEMP=0.01
   export SCALE_HUM=0.01
   export POLL_INTERVAL_MS=1000
   export READ_TIMEOUT_MS=500
   export RETRY_INITIAL_MS=500
   export RETRY_MAX_MS=5000
   export RETRY_MULTIPLIER=2.0

2) Build:

   go build -o ths200-driver

3) Run:

   ./ths200-driver

Quick Test
- Fetch readings:

  curl -s http://localhost:8080/readings

- Check driver status:

  curl -s http://localhost:8080/status

Notes
- The driver reads one 16-bit holding register per measurement and applies the provided SCALE_* factors to convert to human-readable units.
- Sampling interval register is read and returned as an integer value; interpretation (e.g., seconds) depends on the device's specification.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
